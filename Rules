#!/usr/bin/env ruby

preprocess do 
  add_missing_info 
end 

compile '/mailing-list-posts/' do
  filter :erb
  ## no layout as this gets included in homepage '/'
end

compile '/style/*/' do
  filter :sass
end

compile '*' do
  case item[:extension]
  when '.md', '.markdown'
    filter :rdiscount
  when '.haml'
    filter :haml
  when '.html'
    filter :erb
  when '.sass'
    filter :sass
  end
  if item[:layout]
    layout item[:layout]
  else
    layout 'default'
  end
end

route '/mailing-list-posts/' do
  nil
end

route '/mailing-list-posts/[0-9]+/' do
  nil
end

route '/sitemap/' do
  item.identifier.chop + '.xml'
end

route '/style/*/' do
  item.identifier.chop + '.css'
end

route '*' do
  item.identifier + 'index.html'
end

layout '*', :erb
